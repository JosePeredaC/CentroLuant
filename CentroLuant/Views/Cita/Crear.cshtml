@model CentroLuant.Models.CitaCrearViewModel

@{
    ViewData["Title"] = "Registrar cita";
}

<style>
    .panel-wrapper {
        max-width: 950px;
        margin: 0 auto;
        padding: 24px 20px 40px;
    }

    .form-card {
        background: #ffffff;
        border-radius: 18px;
        padding: 28px;
        border: 1px solid #E2E8F0;
        box-shadow: 0 18px 40px rgba(15,23,42,0.08);
    }

    .form-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #0F172A;
    }

    .form-subtitle {
        color: #64748B;
        font-size: .9rem;
        margin-top: 4px;
    }

    .step-title {
        font-size: .9rem;
        font-weight: 600;
        text-transform: uppercase;
        color: #94A3B8;
        margin-top: 20px;
        margin-bottom: 10px;
    }

    .form-label {
        font-weight: 600;
        color: #0F172A;
        font-size: .9rem;
    }

    .form-control,
    .form-select {
        border-radius: 12px;
        border-color: #E2E8F0;
    }

        .form-control:focus,
        .form-select:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 .15rem rgba(59,130,246,.25);
        }

    .btn-primary-strong {
        border-radius: 999px;
        padding: 10px 22px;
        font-weight: 600;
        letter-spacing: .04em;
        text-transform: uppercase;
        font-size: .78rem;
    }

    .btn-secondary-soft {
        border-radius: 999px;
        padding: 10px 18px;
    }

    .helper-text {
        font-size: .8rem;
        color: #94A3B8;
    }

    .badge-step {
        background: #DBEAFE;
        color: #1D4ED8;
        padding: 5px 12px;
        border-radius: 12px;
        font-size: .75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: .08em;
    }
</style>

<div class="panel-wrapper">
    <div class="form-card">

        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h2 class="form-title">Registrar nueva cita</h2>
                <p class="form-subtitle">Seleccione fecha, horario, paciente y especialista asignado.</p>
            </div>

            <span class="badge-step">Agenda clínica</span>
        </div>

        @if (Model.MensajeError != null)
        {
            <div class="alert alert-danger">@Model.MensajeError</div>
        }

        <!-- ========= PASO 1: Seleccionar fecha ========= -->
        <div class="step-title">Seleccionar fecha</div>

        <form asp-action="Crear" method="get" class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label">Fecha</label>
                <input name="fecha"
                       type="date"
                       class="form-control"
                       value="@(Model.FechaSeleccionada?.ToString("yyyy-MM-dd"))" />
            </div>

            <div class="col-md-6 d-flex align-items-end">
                <button class="btn btn-primary btn-primary-strong w-100">
                    Buscar horarios
                </button>
            </div>
        </form>

        @if (Model.HorariosDisponibles.Any())
        {
            <!-- ========= PASO 2: Seleccionar horario ========= -->
            <div class="step-title">Seleccionar horario disponible</div>

            <form asp-action="Crear" method="get" class="row g-3 mb-4">
                <input type="hidden" name="fecha" value="@Model.FechaSeleccionada?.ToString("yyyy-MM-dd")" />

                <div class="col-md-6">
                    <label class="form-label">Horario</label>
                    <select name="hora" class="form-select">
                        @foreach (var h in Model.HorariosDisponibles)
                        {
                            <option value="@h">@h.ToString(@"hh\:mm")</option>
                        }
                    </select>
                </div>

                <div class="col-md-6 d-flex align-items-end">
                    <button class="btn btn-primary btn-primary-strong w-100">
                        Seleccionar horario
                    </button>
                </div>
            </form>
        }

        @if (Model.HoraSeleccionada != null)
        {
            <!-- ========= PASO 3: Ingresar datos del paciente y especialista ========= -->

            <div class="step-title">Completar datos de la cita</div>

            <form asp-action="Crear" method="post" class="mt-3">
                @Html.AntiForgeryToken()

                <input type="hidden" name="Fecha" value="@Model.FechaSeleccionada?.ToString("yyyy-MM-dd")" />
                <input type="hidden" name="Hora" value="@Model.HoraSeleccionada" />

                <div class="row g-3 mb-3">

                    <div class="col-md-6">
                        <label class="form-label">DNI del paciente</label>
                        <input name="DNI_Paciente"
                               class="form-control"
                               maxlength="8"
                               value="@Model.DNI_Paciente" />
                        <span class="helper-text">Debe existir un paciente registrado con este DNI.</span>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Especialista</label>
                        <select name="ID_Especialista" class="form-select">
                            <option value="">-- Seleccione especialista --</option>

                            @foreach (var esp in Model.Especialistas)
                            {
                                <option value="@esp.ID_Usuario"
                                        selected="@(esp.ID_Usuario == Model.ID_Especialista)">
                                    @esp.NombreCompleto
                                </option>
                            }
                        </select>
                    </div>
                </div>

                <input type="hidden" name="Estado" value="Programada" />

                <div class="d-flex justify-content-between mt-3">
                    <a asp-action="Index" class="btn btn-outline-secondary btn-secondary-soft">
                        Cancelar
                    </a>

                    <button type="submit" class="btn btn-primary btn-primary-strong">
                        Guardar cita
                    </button>
                </div>
            </form>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
